{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "WF-TECH-006 Security System Schemas",
  "description": "Comprehensive security schemas for WIRTHFORGE authentication, authorization, and threat management",
  "definitions": {
    "SecurityPolicy": {
      "type": "object",
      "title": "Security Policy Schema",
      "required": ["version", "name", "rules", "enforcement"],
      "properties": {
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Policy version (semantic versioning)"
        },
        "name": {
          "type": "string",
          "minLength": 3,
          "maxLength": 100,
          "description": "Policy identifier"
        },
        "description": {
          "type": "string",
          "maxLength": 500
        },
        "rules": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/SecurityRule"
          },
          "minItems": 1
        },
        "enforcement": {
          "type": "object",
          "required": ["mode", "actions"],
          "properties": {
            "mode": {
              "type": "string",
              "enum": ["strict", "permissive", "audit"],
              "description": "Policy enforcement mode"
            },
            "actions": {
              "type": "object",
              "properties": {
                "onViolation": {
                  "type": "string",
                  "enum": ["block", "warn", "log", "terminate"]
                },
                "onSuspiciousActivity": {
                  "type": "string",
                  "enum": ["monitor", "restrict", "isolate", "block"]
                }
              }
            }
          }
        },
        "scope": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["system", "network", "plugins", "data", "ui", "api"]
          }
        },
        "validFrom": {
          "type": "string",
          "format": "date-time"
        },
        "validUntil": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "SecurityRule": {
      "type": "object",
      "title": "Security Rule Schema",
      "required": ["id", "type", "condition", "action"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9-]+$",
          "description": "Unique rule identifier"
        },
        "type": {
          "type": "string",
          "enum": [
            "authentication",
            "authorization",
            "network_access",
            "resource_limit",
            "data_protection",
            "threat_detection",
            "audit_requirement"
          ]
        },
        "condition": {
          "$ref": "#/definitions/SecurityCondition"
        },
        "action": {
          "$ref": "#/definitions/SecurityAction"
        },
        "priority": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "description": "Rule priority (1=highest)"
        },
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "description": {
          "type": "string",
          "maxLength": 200
        }
      }
    },
    "SecurityCondition": {
      "type": "object",
      "title": "Security Condition Schema",
      "properties": {
        "subject": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["user", "plugin", "process", "network", "system"]
            },
            "identifier": {
              "type": "string"
            },
            "attributes": {
              "type": "object"
            }
          }
        },
        "resource": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["api", "data", "network", "file", "capability"]
            },
            "path": {
              "type": "string"
            },
            "permissions": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["read", "write", "execute", "delete", "admin"]
              }
            }
          }
        },
        "context": {
          "type": "object",
          "properties": {
            "timeWindow": {
              "type": "object",
              "properties": {
                "start": {
                  "type": "string",
                  "format": "time"
                },
                "end": {
                  "type": "string",
                  "format": "time"
                }
              }
            },
            "location": {
              "type": "object",
              "properties": {
                "allowedNetworks": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "format": "ipv4"
                  }
                },
                "blockedNetworks": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "format": "ipv4"
                  }
                }
              }
            },
            "rateLimit": {
              "type": "object",
              "properties": {
                "maxRequests": {
                  "type": "integer",
                  "minimum": 1
                },
                "timeWindowMs": {
                  "type": "integer",
                  "minimum": 1000
                }
              }
            }
          }
        }
      }
    },
    "SecurityAction": {
      "type": "object",
      "title": "Security Action Schema",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "allow",
            "deny",
            "require_auth",
            "require_mfa",
            "rate_limit",
            "audit_log",
            "alert",
            "quarantine",
            "terminate"
          ]
        },
        "parameters": {
          "type": "object",
          "properties": {
            "message": {
              "type": "string"
            },
            "severity": {
              "type": "string",
              "enum": ["low", "medium", "high", "critical"]
            },
            "notificationChannels": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["log", "email", "webhook", "ui"]
              }
            },
            "quarantineDurationMs": {
              "type": "integer",
              "minimum": 1000
            }
          }
        }
      }
    },
    "AuthenticationConfig": {
      "type": "object",
      "title": "Authentication Configuration Schema",
      "required": ["methods", "session"],
      "properties": {
        "methods": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type", "enabled"],
            "properties": {
              "type": {
                "type": "string",
                "enum": ["local", "oauth2", "saml", "ldap", "certificate"]
              },
              "enabled": {
                "type": "boolean"
              },
              "config": {
                "type": "object",
                "properties": {
                  "provider": {
                    "type": "string"
                  },
                  "clientId": {
                    "type": "string"
                  },
                  "redirectUri": {
                    "type": "string",
                    "format": "uri"
                  },
                  "scopes": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "session": {
          "type": "object",
          "required": ["timeout", "storage"],
          "properties": {
            "timeout": {
              "type": "integer",
              "minimum": 300,
              "maximum": 86400,
              "description": "Session timeout in seconds"
            },
            "storage": {
              "type": "string",
              "enum": ["memory", "database", "redis"]
            },
            "secure": {
              "type": "boolean",
              "default": true
            },
            "httpOnly": {
              "type": "boolean",
              "default": true
            }
          }
        },
        "passwordPolicy": {
          "type": "object",
          "properties": {
            "minLength": {
              "type": "integer",
              "minimum": 8,
              "default": 12
            },
            "requireUppercase": {
              "type": "boolean",
              "default": true
            },
            "requireLowercase": {
              "type": "boolean",
              "default": true
            },
            "requireNumbers": {
              "type": "boolean",
              "default": true
            },
            "requireSymbols": {
              "type": "boolean",
              "default": true
            },
            "maxAge": {
              "type": "integer",
              "description": "Password max age in days"
            }
          }
        },
        "mfa": {
          "type": "object",
          "properties": {
            "required": {
              "type": "boolean",
              "default": false
            },
            "methods": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["totp", "sms", "email", "hardware_token"]
              }
            }
          }
        }
      }
    },
    "ThreatDetectionRule": {
      "type": "object",
      "title": "Threat Detection Rule Schema",
      "required": ["id", "name", "pattern", "severity", "response"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9-]+$"
        },
        "name": {
          "type": "string",
          "minLength": 5,
          "maxLength": 100
        },
        "description": {
          "type": "string",
          "maxLength": 500
        },
        "pattern": {
          "type": "object",
          "required": ["type"],
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "anomaly_detection",
                "signature_match",
                "behavioral_analysis",
                "rate_threshold",
                "geo_location",
                "time_based"
              ]
            },
            "parameters": {
              "type": "object",
              "properties": {
                "threshold": {
                  "type": "number"
                },
                "timeWindow": {
                  "type": "integer",
                  "description": "Time window in seconds"
                },
                "baseline": {
                  "type": "object",
                  "properties": {
                    "period": {
                      "type": "integer",
                      "description": "Baseline period in days"
                    },
                    "deviationThreshold": {
                      "type": "number",
                      "minimum": 1.0,
                      "description": "Standard deviations for anomaly"
                    }
                  }
                },
                "signatures": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "severity": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "response": {
          "type": "object",
          "required": ["immediate", "escalation"],
          "properties": {
            "immediate": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/SecurityAction"
              }
            },
            "escalation": {
              "type": "object",
              "properties": {
                "after": {
                  "type": "integer",
                  "description": "Escalation delay in seconds"
                },
                "actions": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/SecurityAction"
                  }
                }
              }
            }
          }
        },
        "enabled": {
          "type": "boolean",
          "default": true
        }
      }
    },
    "SecurityEvent": {
      "type": "object",
      "title": "Security Event Schema",
      "required": ["id", "timestamp", "type", "severity", "source"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "enum": [
            "authentication_success",
            "authentication_failure",
            "authorization_denied",
            "suspicious_activity",
            "policy_violation",
            "threat_detected",
            "system_compromise",
            "data_breach"
          ]
        },
        "severity": {
          "type": "string",
          "enum": ["info", "warning", "error", "critical"]
        },
        "source": {
          "type": "object",
          "required": ["component"],
          "properties": {
            "component": {
              "type": "string",
              "enum": ["auth", "network", "plugin", "api", "ui", "system"]
            },
            "userId": {
              "type": "string"
            },
            "ipAddress": {
              "type": "string",
              "format": "ipv4"
            },
            "userAgent": {
              "type": "string"
            },
            "sessionId": {
              "type": "string"
            }
          }
        },
        "details": {
          "type": "object",
          "properties": {
            "message": {
              "type": "string"
            },
            "ruleId": {
              "type": "string"
            },
            "resource": {
              "type": "string"
            },
            "action": {
              "type": "string"
            },
            "metadata": {
              "type": "object"
            }
          }
        },
        "response": {
          "type": "object",
          "properties": {
            "action": {
              "type": "string"
            },
            "success": {
              "type": "boolean"
            },
            "message": {
              "type": "string"
            }
          }
        }
      }
    },
    "CertificateConfig": {
      "type": "object",
      "title": "Certificate Configuration Schema",
      "required": ["certificates", "validation"],
      "properties": {
        "certificates": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "type", "path"],
            "properties": {
              "name": {
                "type": "string"
              },
              "type": {
                "type": "string",
                "enum": ["server", "client", "ca", "intermediate"]
              },
              "path": {
                "type": "string",
                "description": "Path to certificate file"
              },
              "keyPath": {
                "type": "string",
                "description": "Path to private key file"
              },
              "passphrase": {
                "type": "string",
                "description": "Key passphrase (encrypted)"
              },
              "validFrom": {
                "type": "string",
                "format": "date-time"
              },
              "validUntil": {
                "type": "string",
                "format": "date-time"
              },
              "domains": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "validation": {
          "type": "object",
          "properties": {
            "checkExpiry": {
              "type": "boolean",
              "default": true
            },
            "warningDays": {
              "type": "integer",
              "minimum": 1,
              "default": 30,
              "description": "Days before expiry to warn"
            },
            "checkRevocation": {
              "type": "boolean",
              "default": true
            },
            "ocspEnabled": {
              "type": "boolean",
              "default": true
            }
          }
        },
        "autoRenewal": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "provider": {
              "type": "string",
              "enum": ["letsencrypt", "internal_ca"]
            },
            "renewalDays": {
              "type": "integer",
              "minimum": 1,
              "default": 30
            }
          }
        }
      }
    },
    "NetworkSecurityConfig": {
      "type": "object",
      "title": "Network Security Configuration Schema",
      "required": ["firewall", "tls"],
      "properties": {
        "firewall": {
          "type": "object",
          "required": ["enabled", "rules"],
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "defaultPolicy": {
              "type": "string",
              "enum": ["allow", "deny"],
              "default": "deny"
            },
            "rules": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["action", "protocol"],
                "properties": {
                  "action": {
                    "type": "string",
                    "enum": ["allow", "deny"]
                  },
                  "protocol": {
                    "type": "string",
                    "enum": ["tcp", "udp", "icmp", "all"]
                  },
                  "sourceIp": {
                    "type": "string"
                  },
                  "destinationIp": {
                    "type": "string"
                  },
                  "sourcePort": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 65535
                  },
                  "destinationPort": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 65535
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "tls": {
          "type": "object",
          "required": ["minVersion", "cipherSuites"],
          "properties": {
            "minVersion": {
              "type": "string",
              "enum": ["1.2", "1.3"],
              "default": "1.2"
            },
            "maxVersion": {
              "type": "string",
              "enum": ["1.2", "1.3"],
              "default": "1.3"
            },
            "cipherSuites": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": [
                "TLS_AES_256_GCM_SHA384",
                "TLS_CHACHA20_POLY1305_SHA256",
                "TLS_AES_128_GCM_SHA256"
              ]
            },
            "requireClientCert": {
              "type": "boolean",
              "default": false
            },
            "hsts": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true
                },
                "maxAge": {
                  "type": "integer",
                  "default": 31536000
                },
                "includeSubDomains": {
                  "type": "boolean",
                  "default": true
                }
              }
            }
          }
        },
        "rateLimiting": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "rules": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "path": {
                    "type": "string"
                  },
                  "method": {
                    "type": "string",
                    "enum": ["GET", "POST", "PUT", "DELETE", "PATCH", "ALL"]
                  },
                  "maxRequests": {
                    "type": "integer",
                    "minimum": 1
                  },
                  "timeWindowMs": {
                    "type": "integer",
                    "minimum": 1000
                  },
                  "byIp": {
                    "type": "boolean",
                    "default": true
                  },
                  "byUser": {
                    "type": "boolean",
                    "default": false
                  }
                }
              }
            }
          }
        }
      }
    },
    "AuditConfig": {
      "type": "object",
      "title": "Audit Configuration Schema",
      "required": ["enabled", "events", "storage"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "events": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "authentication",
              "authorization",
              "data_access",
              "configuration_change",
              "system_event",
              "security_event",
              "plugin_event",
              "api_call"
            ]
          }
        },
        "storage": {
          "type": "object",
          "required": ["type"],
          "properties": {
            "type": {
              "type": "string",
              "enum": ["file", "database", "syslog", "elasticsearch"]
            },
            "config": {
              "type": "object",
              "properties": {
                "path": {
                  "type": "string"
                },
                "maxSize": {
                  "type": "string",
                  "description": "Maximum log file size (e.g., 100MB)"
                },
                "retention": {
                  "type": "integer",
                  "description": "Retention period in days"
                },
                "compression": {
                  "type": "boolean",
                  "default": true
                }
              }
            }
          }
        },
        "filters": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "field": {
                "type": "string"
              },
              "operator": {
                "type": "string",
                "enum": ["equals", "contains", "startsWith", "regex"]
              },
              "value": {
                "type": "string"
              },
              "action": {
                "type": "string",
                "enum": ["include", "exclude"]
              }
            }
          }
        }
      }
    }
  },
  "anyOf": [
    {
      "$ref": "#/definitions/SecurityPolicy"
    },
    {
      "$ref": "#/definitions/AuthenticationConfig"
    },
    {
      "$ref": "#/definitions/ThreatDetectionRule"
    },
    {
      "$ref": "#/definitions/SecurityEvent"
    },
    {
      "$ref": "#/definitions/CertificateConfig"
    },
    {
      "$ref": "#/definitions/NetworkSecurityConfig"
    },
    {
      "$ref": "#/definitions/AuditConfig"
    }
  ]
}
