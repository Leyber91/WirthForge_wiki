{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wirthforge.org/schemas/WF-OPS-002-export-manifest.json",
  "title": "WIRTHFORGE Export Manifest Schema",
  "description": "Schema for defining export manifests and privacy-preserving data exports in the WIRTHFORGE monitoring system",
  "type": "object",
  "required": [
    "export_id",
    "version",
    "created_at",
    "export_type",
    "data_scope",
    "privacy_level",
    "consent_record"
  ],
  "properties": {
    "export_id": {
      "type": "string",
      "pattern": "^export_[0-9]{4}-[0-9]{2}-[0-9]{2}_[0-9]{6}$",
      "description": "Unique export identifier with timestamp",
      "examples": [
        "export_2024-08-19_120000",
        "export_2024-08-19_143022"
      ]
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "description": "Export manifest schema version",
      "default": "1.0"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Export creation timestamp"
    },
    "export_type": {
      "type": "string",
      "enum": [
        "diagnostic_bundle",
        "performance_report",
        "analytics_summary",
        "raw_metrics",
        "alert_history",
        "custom_selection"
      ],
      "description": "Type of export being created"
    },
    "data_scope": {
      "type": "object",
      "required": ["time_range", "categories"],
      "properties": {
        "time_range": {
          "type": "object",
          "required": ["start", "end"],
          "properties": {
            "start": {
              "type": "string",
              "format": "date-time",
              "description": "Start time for data export"
            },
            "end": {
              "type": "string",
              "format": "date-time",
              "description": "End time for data export"
            },
            "duration_hours": {
              "type": "number",
              "minimum": 0.1,
              "maximum": 8760,
              "description": "Duration in hours"
            }
          },
          "additionalProperties": false
        },
        "categories": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "enum": [
              "system_metrics",
              "model_performance",
              "ui_metrics",
              "network_stats",
              "alert_events",
              "error_logs",
              "analytics_insights",
              "user_interactions"
            ]
          },
          "description": "Data categories included in export"
        },
        "metrics": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9_.-]+$"
          },
          "description": "Specific metrics to include"
        },
        "resolution": {
          "type": "string",
          "enum": [
            "raw",
            "1s_avg",
            "10s_avg",
            "1m_avg",
            "5m_avg",
            "15m_avg",
            "1h_avg"
          ],
          "description": "Data resolution/aggregation level",
          "default": "1m_avg"
        },
        "max_records": {
          "type": "integer",
          "minimum": 100,
          "maximum": 1000000,
          "description": "Maximum number of records to export"
        }
      },
      "additionalProperties": false
    },
    "privacy_level": {
      "type": "string",
      "enum": [
        "public",
        "anonymous",
        "k_anonymous_5",
        "k_anonymous_10",
        "aggregated_only",
        "full_privacy"
      ],
      "description": "Privacy protection level for exported data",
      "default": "k_anonymous_5"
    },
    "consent_record": {
      "type": "object",
      "required": ["user_consent", "consent_timestamp"],
      "properties": {
        "user_consent": {
          "type": "boolean",
          "description": "Explicit user consent for this export"
        },
        "consent_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When consent was granted"
        },
        "consent_method": {
          "type": "string",
          "enum": [
            "ui_dialog",
            "api_request",
            "cli_command",
            "configuration_file"
          ],
          "description": "How consent was obtained"
        },
        "consent_details": {
          "type": "string",
          "maxLength": 500,
          "description": "Additional consent details or restrictions"
        },
        "revocable": {
          "type": "boolean",
          "description": "Whether consent can be revoked",
          "default": true
        },
        "expiry": {
          "type": "string",
          "format": "date-time",
          "description": "When consent expires (optional)"
        }
      },
      "additionalProperties": false
    },
    "processing_config": {
      "type": "object",
      "properties": {
        "anonymization": {
          "type": "object",
          "properties": {
            "remove_pii": {
              "type": "boolean",
              "description": "Remove personally identifiable information",
              "default": true
            },
            "k_anonymity": {
              "type": "integer",
              "minimum": 2,
              "maximum": 100,
              "description": "K-anonymity parameter"
            },
            "suppress_outliers": {
              "type": "boolean",
              "description": "Suppress statistical outliers",
              "default": true
            },
            "generalize_timestamps": {
              "type": "boolean",
              "description": "Generalize timestamps to protect privacy",
              "default": true
            }
          },
          "additionalProperties": false
        },
        "filtering": {
          "type": "object",
          "properties": {
            "exclude_sensitive": {
              "type": "boolean",
              "description": "Exclude sensitive data categories",
              "default": true
            },
            "exclude_errors": {
              "type": "boolean",
              "description": "Exclude error logs and stack traces",
              "default": false
            },
            "exclude_user_content": {
              "type": "boolean",
              "description": "Exclude any user-generated content",
              "default": true
            },
            "custom_filters": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "field": {
                    "type": "string",
                    "description": "Field to filter"
                  },
                  "condition": {
                    "type": "string",
                    "enum": ["equals", "contains", "regex", "greater_than", "less_than"]
                  },
                  "value": {
                    "oneOf": [
                      {"type": "string"},
                      {"type": "number"},
                      {"type": "boolean"}
                    ]
                  },
                  "action": {
                    "type": "string",
                    "enum": ["exclude", "include", "anonymize", "generalize"]
                  }
                }
              }
            }
          },
          "additionalProperties": false
        },
        "compression": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable compression",
              "default": true
            },
            "algorithm": {
              "type": "string",
              "enum": ["gzip", "lz4", "zstd"],
              "description": "Compression algorithm",
              "default": "gzip"
            },
            "level": {
              "type": "integer",
              "minimum": 1,
              "maximum": 9,
              "description": "Compression level",
              "default": 6
            }
          },
          "additionalProperties": false
        },
        "encryption": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable encryption",
              "default": false
            },
            "algorithm": {
              "type": "string",
              "enum": ["AES-256-GCM", "ChaCha20-Poly1305"],
              "description": "Encryption algorithm"
            },
            "key_derivation": {
              "type": "string",
              "enum": ["PBKDF2", "Argon2id"],
              "description": "Key derivation function"
            },
            "password_required": {
              "type": "boolean",
              "description": "Whether password is required for decryption"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "output_config": {
      "type": "object",
      "required": ["format"],
      "properties": {
        "format": {
          "type": "string",
          "enum": [
            "json",
            "jsonl",
            "csv",
            "parquet",
            "sqlite",
            "zip_archive"
          ],
          "description": "Output format for exported data"
        },
        "filename": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9_.-]+$",
          "description": "Output filename (without extension)"
        },
        "destination": {
          "type": "string",
          "enum": [
            "local_file",
            "user_downloads",
            "custom_path",
            "memory_buffer"
          ],
          "description": "Export destination",
          "default": "user_downloads"
        },
        "custom_path": {
          "type": "string",
          "description": "Custom file path (if destination is custom_path)"
        },
        "split_files": {
          "type": "boolean",
          "description": "Split large exports into multiple files",
          "default": false
        },
        "max_file_size_mb": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1000,
          "description": "Maximum file size in MB before splitting"
        }
      },
      "additionalProperties": false
    },
    "metadata": {
      "type": "object",
      "properties": {
        "title": {
          "type": "string",
          "maxLength": 200,
          "description": "Human-readable title for the export"
        },
        "description": {
          "type": "string",
          "maxLength": 1000,
          "description": "Description of the export contents and purpose"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9_-]+$"
          },
          "description": "Tags for export organization"
        },
        "system_info": {
          "type": "object",
          "properties": {
            "wirthforge_version": {
              "type": "string",
              "description": "WIRTHFORGE version"
            },
            "platform": {
              "type": "string",
              "description": "Operating system platform"
            },
            "architecture": {
              "type": "string",
              "description": "System architecture"
            },
            "node_version": {
              "type": "string",
              "description": "Node.js version"
            }
          },
          "additionalProperties": false
        },
        "export_stats": {
          "type": "object",
          "properties": {
            "total_records": {
              "type": "integer",
              "minimum": 0,
              "description": "Total number of records exported"
            },
            "file_size_bytes": {
              "type": "integer",
              "minimum": 0,
              "description": "Total file size in bytes"
            },
            "processing_time_ms": {
              "type": "integer",
              "minimum": 0,
              "description": "Processing time in milliseconds"
            },
            "compression_ratio": {
              "type": "number",
              "minimum": 0,
              "description": "Compression ratio achieved"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "validation": {
      "type": "object",
      "properties": {
        "checksum": {
          "type": "string",
          "pattern": "^[a-fA-F0-9]{64}$",
          "description": "SHA-256 checksum of exported data"
        },
        "integrity_verified": {
          "type": "boolean",
          "description": "Whether data integrity was verified"
        },
        "privacy_validated": {
          "type": "boolean",
          "description": "Whether privacy requirements were validated"
        },
        "schema_version": {
          "type": "string",
          "description": "Schema version used for validation"
        },
        "validation_errors": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "field": {
                "type": "string",
                "description": "Field with validation error"
              },
              "error": {
                "type": "string",
                "description": "Error description"
              },
              "severity": {
                "type": "string",
                "enum": ["warning", "error", "critical"]
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "sharing_config": {
      "type": "object",
      "properties": {
        "shareable": {
          "type": "boolean",
          "description": "Whether export can be shared externally",
          "default": false
        },
        "sharing_restrictions": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "internal_only",
              "support_only",
              "research_only",
              "no_commercial_use",
              "attribution_required"
            ]
          },
          "description": "Restrictions on data sharing"
        },
        "expiry_date": {
          "type": "string",
          "format": "date-time",
          "description": "When sharing permission expires"
        },
        "recipient_restrictions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Allowed recipients for sharing"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "export_id": "export_2024-08-19_120000",
      "version": "1.0",
      "created_at": "2024-08-19T12:00:00Z",
      "export_type": "diagnostic_bundle",
      "data_scope": {
        "time_range": {
          "start": "2024-08-19T11:00:00Z",
          "end": "2024-08-19T12:00:00Z",
          "duration_hours": 1.0
        },
        "categories": [
          "system_metrics",
          "model_performance",
          "ui_metrics",
          "alert_events"
        ],
        "resolution": "1m_avg",
        "max_records": 10000
      },
      "privacy_level": "k_anonymous_5",
      "consent_record": {
        "user_consent": true,
        "consent_timestamp": "2024-08-19T11:59:30Z",
        "consent_method": "ui_dialog",
        "consent_details": "User requested diagnostic export for performance troubleshooting",
        "revocable": true
      },
      "processing_config": {
        "anonymization": {
          "remove_pii": true,
          "k_anonymity": 5,
          "suppress_outliers": true,
          "generalize_timestamps": true
        },
        "filtering": {
          "exclude_sensitive": true,
          "exclude_errors": false,
          "exclude_user_content": true
        },
        "compression": {
          "enabled": true,
          "algorithm": "gzip",
          "level": 6
        },
        "encryption": {
          "enabled": false
        }
      },
      "output_config": {
        "format": "zip_archive",
        "filename": "wirthforge_diagnostic_2024-08-19_120000",
        "destination": "user_downloads",
        "split_files": false
      },
      "metadata": {
        "title": "WIRTHFORGE Diagnostic Bundle",
        "description": "Performance diagnostic data for troubleshooting frame rate issues",
        "tags": ["diagnostic", "performance", "troubleshooting"],
        "system_info": {
          "wirthforge_version": "1.0.0",
          "platform": "win32",
          "architecture": "x64",
          "node_version": "v18.17.0"
        },
        "export_stats": {
          "total_records": 3600,
          "file_size_bytes": 2457600,
          "processing_time_ms": 1250,
          "compression_ratio": 4.2
        }
      },
      "validation": {
        "checksum": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456",
        "integrity_verified": true,
        "privacy_validated": true,
        "schema_version": "1.0"
      },
      "sharing_config": {
        "shareable": true,
        "sharing_restrictions": ["support_only"],
        "expiry_date": "2024-09-19T12:00:00Z"
      }
    },
    {
      "export_id": "export_2024-08-19_143022",
      "version": "1.0",
      "created_at": "2024-08-19T14:30:22Z",
      "export_type": "performance_report",
      "data_scope": {
        "time_range": {
          "start": "2024-08-12T00:00:00Z",
          "end": "2024-08-19T14:30:00Z",
          "duration_hours": 182.5
        },
        "categories": [
          "system_metrics",
          "model_performance",
          "analytics_insights"
        ],
        "metrics": [
          "cpu_percent",
          "memory_percent",
          "tokens_per_second",
          "frame_time_ms",
          "energy_normalized"
        ],
        "resolution": "15m_avg",
        "max_records": 50000
      },
      "privacy_level": "aggregated_only",
      "consent_record": {
        "user_consent": true,
        "consent_timestamp": "2024-08-19T14:29:45Z",
        "consent_method": "ui_dialog",
        "consent_details": "Weekly performance report export for analysis",
        "revocable": true
      },
      "processing_config": {
        "anonymization": {
          "remove_pii": true,
          "k_anonymity": 10,
          "suppress_outliers": false,
          "generalize_timestamps": false
        },
        "filtering": {
          "exclude_sensitive": true,
          "exclude_errors": true,
          "exclude_user_content": true
        },
        "compression": {
          "enabled": true,
          "algorithm": "lz4",
          "level": 4
        }
      },
      "output_config": {
        "format": "csv",
        "filename": "wirthforge_performance_week_2024-08-19",
        "destination": "user_downloads"
      },
      "metadata": {
        "title": "Weekly Performance Report",
        "description": "Aggregated performance metrics for the past week",
        "tags": ["performance", "weekly", "analytics"],
        "system_info": {
          "wirthforge_version": "1.0.0",
          "platform": "win32",
          "architecture": "x64"
        }
      },
      "validation": {
        "checksum": "b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef1234567",
        "integrity_verified": true,
        "privacy_validated": true
      },
      "sharing_config": {
        "shareable": false
      }
    }
  ]
}
