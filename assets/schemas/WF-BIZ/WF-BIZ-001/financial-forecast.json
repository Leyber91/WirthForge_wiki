{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wirthforge.org/schemas/wf-biz-001/financial-forecast.json",
  "title": "WIRTHFORGE Financial Forecast Schema",
  "description": "Defines financial forecasting structure for local-first AI platform business model",
  "type": "object",
  "properties": {
    "forecastId": {
      "type": "string",
      "pattern": "^FF-[0-9]{4}-[0-9]{2}$",
      "description": "Unique forecast identifier (e.g., 'FF-2024-01')"
    },
    "forecastName": {
      "type": "string",
      "minLength": 5,
      "maxLength": 100,
      "description": "Human-readable forecast name"
    },
    "timeframe": {
      "type": "object",
      "properties": {
        "startDate": {
          "type": "string",
          "format": "date"
        },
        "endDate": {
          "type": "string",
          "format": "date"
        },
        "granularity": {
          "type": "string",
          "enum": ["monthly", "quarterly", "annual"]
        },
        "horizon": {
          "type": "string",
          "enum": ["short_term", "medium_term", "long_term"],
          "description": "1-2 years, 3-5 years, 5+ years"
        }
      },
      "required": ["startDate", "endDate", "granularity", "horizon"]
    },
    "scenarios": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "scenarioId": {
            "type": "string",
            "pattern": "^SC-[0-9]{3}$"
          },
          "scenarioName": {
            "type": "string",
            "enum": ["conservative", "realistic", "optimistic", "stress_test"]
          },
          "probability": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Probability of this scenario occurring"
          },
          "assumptions": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "assumptionId": {
                  "type": "string",
                  "pattern": "^AS-[0-9]{3}$"
                },
                "description": {
                  "type": "string"
                },
                "category": {
                  "type": "string",
                  "enum": [
                    "market_growth",
                    "user_adoption",
                    "pricing_strategy",
                    "competition",
                    "technology_development",
                    "regulatory_environment",
                    "economic_conditions"
                  ]
                },
                "value": {
                  "type": "string",
                  "description": "Quantified assumption value"
                },
                "confidence": {
                  "type": "string",
                  "enum": ["low", "medium", "high"]
                }
              },
              "required": ["assumptionId", "description", "category", "value", "confidence"]
            }
          },
          "periods": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "period": {
                  "type": "string",
                  "description": "Period identifier (e.g., '2024-Q1', '2024-01')"
                },
                "revenue": {
                  "type": "object",
                  "properties": {
                    "subscription": {
                      "type": "object",
                      "properties": {
                        "free_users": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "personal_users": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "professional_users": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "enterprise_users": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "total_revenue": {
                          "type": "number",
                          "minimum": 0
                        }
                      },
                      "required": ["total_revenue"]
                    },
                    "energy_billing": {
                      "type": "object",
                      "properties": {
                        "total_kwh": {
                          "type": "number",
                          "minimum": 0
                        },
                        "average_rate": {
                          "type": "number",
                          "minimum": 0
                        },
                        "total_revenue": {
                          "type": "number",
                          "minimum": 0
                        }
                      },
                      "required": ["total_revenue"]
                    },
                    "marketplace": {
                      "type": "object",
                      "properties": {
                        "transaction_volume": {
                          "type": "number",
                          "minimum": 0
                        },
                        "commission_rate": {
                          "type": "number",
                          "minimum": 0,
                          "maximum": 1
                        },
                        "total_revenue": {
                          "type": "number",
                          "minimum": 0
                        }
                      },
                      "required": ["total_revenue"]
                    },
                    "professional_services": {
                      "type": "object",
                      "properties": {
                        "hours_billed": {
                          "type": "number",
                          "minimum": 0
                        },
                        "average_rate": {
                          "type": "number",
                          "minimum": 0
                        },
                        "total_revenue": {
                          "type": "number",
                          "minimum": 0
                        }
                      },
                      "required": ["total_revenue"]
                    },
                    "total_revenue": {
                      "type": "number",
                      "minimum": 0
                    }
                  },
                  "required": ["total_revenue"]
                },
                "costs": {
                  "type": "object",
                  "properties": {
                    "development": {
                      "type": "object",
                      "properties": {
                        "personnel": {
                          "type": "number",
                          "minimum": 0
                        },
                        "tools": {
                          "type": "number",
                          "minimum": 0
                        },
                        "research": {
                          "type": "number",
                          "minimum": 0
                        },
                        "total": {
                          "type": "number",
                          "minimum": 0
                        }
                      },
                      "required": ["total"]
                    },
                    "operations": {
                      "type": "object",
                      "properties": {
                        "infrastructure": {
                          "type": "number",
                          "minimum": 0
                        },
                        "support": {
                          "type": "number",
                          "minimum": 0
                        },
                        "energy": {
                          "type": "number",
                          "minimum": 0
                        },
                        "total": {
                          "type": "number",
                          "minimum": 0
                        }
                      },
                      "required": ["total"]
                    },
                    "marketing": {
                      "type": "object",
                      "properties": {
                        "content": {
                          "type": "number",
                          "minimum": 0
                        },
                        "community": {
                          "type": "number",
                          "minimum": 0
                        },
                        "events": {
                          "type": "number",
                          "minimum": 0
                        },
                        "total": {
                          "type": "number",
                          "minimum": 0
                        }
                      },
                      "required": ["total"]
                    },
                    "compliance": {
                      "type": "object",
                      "properties": {
                        "legal": {
                          "type": "number",
                          "minimum": 0
                        },
                        "privacy": {
                          "type": "number",
                          "minimum": 0
                        },
                        "security": {
                          "type": "number",
                          "minimum": 0
                        },
                        "total": {
                          "type": "number",
                          "minimum": 0
                        }
                      },
                      "required": ["total"]
                    },
                    "total_costs": {
                      "type": "number",
                      "minimum": 0
                    }
                  },
                  "required": ["total_costs"]
                },
                "metrics": {
                  "type": "object",
                  "properties": {
                    "gross_profit": {
                      "type": "number"
                    },
                    "gross_margin": {
                      "type": "number",
                      "minimum": -1,
                      "maximum": 1
                    },
                    "operating_profit": {
                      "type": "number"
                    },
                    "operating_margin": {
                      "type": "number",
                      "minimum": -1,
                      "maximum": 1
                    },
                    "net_profit": {
                      "type": "number"
                    },
                    "net_margin": {
                      "type": "number",
                      "minimum": -1,
                      "maximum": 1
                    },
                    "cash_flow": {
                      "type": "number"
                    },
                    "cumulative_cash": {
                      "type": "number"
                    }
                  },
                  "required": ["gross_profit", "operating_profit", "net_profit", "cash_flow"]
                },
                "kpis": {
                  "type": "object",
                  "properties": {
                    "total_users": {
                      "type": "integer",
                      "minimum": 0
                    },
                    "paying_users": {
                      "type": "integer",
                      "minimum": 0
                    },
                    "conversion_rate": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1
                    },
                    "churn_rate": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1
                    },
                    "arpu": {
                      "type": "number",
                      "minimum": 0,
                      "description": "Average Revenue Per User"
                    },
                    "ltv": {
                      "type": "number",
                      "minimum": 0,
                      "description": "Customer Lifetime Value"
                    },
                    "cac": {
                      "type": "number",
                      "minimum": 0,
                      "description": "Customer Acquisition Cost"
                    },
                    "ltv_cac_ratio": {
                      "type": "number",
                      "minimum": 0
                    },
                    "burn_rate": {
                      "type": "number",
                      "description": "Monthly cash burn (negative for burn)"
                    },
                    "runway_months": {
                      "type": "number",
                      "minimum": 0,
                      "description": "Cash runway in months"
                    }
                  }
                }
              },
              "required": ["period", "revenue", "costs", "metrics"]
            },
            "minItems": 1
          }
        },
        "required": ["scenarioId", "scenarioName", "probability", "assumptions", "periods"]
      },
      "minItems": 1,
      "maxItems": 4
    },
    "sensitivityAnalysis": {
      "type": "object",
      "properties": {
        "variables": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "variableId": {
                "type": "string",
                "pattern": "^SA-[0-9]{3}$"
              },
              "name": {
                "type": "string"
              },
              "category": {
                "type": "string",
                "enum": [
                  "user_growth_rate",
                  "conversion_rate",
                  "churn_rate",
                  "pricing",
                  "cost_inflation",
                  "market_size",
                  "competition_impact"
                ]
              },
              "baseValue": {
                "type": "number"
              },
              "range": {
                "type": "object",
                "properties": {
                  "min": {
                    "type": "number"
                  },
                  "max": {
                    "type": "number"
                  }
                },
                "required": ["min", "max"]
              },
              "impact": {
                "type": "object",
                "properties": {
                  "revenue": {
                    "type": "string",
                    "enum": ["low", "medium", "high", "critical"]
                  },
                  "profitability": {
                    "type": "string",
                    "enum": ["low", "medium", "high", "critical"]
                  },
                  "cash_flow": {
                    "type": "string",
                    "enum": ["low", "medium", "high", "critical"]
                  }
                },
                "required": ["revenue", "profitability", "cash_flow"]
              }
            },
            "required": ["variableId", "name", "category", "baseValue", "range", "impact"]
          }
        }
      }
    },
    "riskFactors": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "riskId": {
            "type": "string",
            "pattern": "^RF-[0-9]{3}$"
          },
          "description": {
            "type": "string"
          },
          "category": {
            "type": "string",
            "enum": [
              "market_risk",
              "technology_risk",
              "competitive_risk",
              "regulatory_risk",
              "operational_risk",
              "financial_risk"
            ]
          },
          "probability": {
            "type": "string",
            "enum": ["very_low", "low", "medium", "high", "very_high"]
          },
          "impact": {
            "type": "string",
            "enum": ["minimal", "low", "medium", "high", "severe"]
          },
          "financialImpact": {
            "type": "object",
            "properties": {
              "revenueImpact": {
                "type": "number",
                "description": "Percentage impact on revenue (-0.5 = -50%)"
              },
              "costImpact": {
                "type": "number",
                "description": "Percentage impact on costs (0.2 = +20%)"
              },
              "timeframe": {
                "type": "string",
                "enum": ["immediate", "short_term", "medium_term", "long_term"]
              }
            }
          },
          "mitigation": {
            "type": "object",
            "properties": {
              "strategy": {
                "type": "string"
              },
              "cost": {
                "type": "number",
                "minimum": 0
              },
              "effectiveness": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              }
            },
            "required": ["strategy"]
          }
        },
        "required": ["riskId", "description", "category", "probability", "impact"]
      }
    },
    "fundingRequirements": {
      "type": "object",
      "properties": {
        "totalRequired": {
          "type": "number",
          "minimum": 0,
          "description": "Total funding required in USD"
        },
        "stages": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "stageId": {
                "type": "string",
                "pattern": "^FS-[0-9]{2}$"
              },
              "stageName": {
                "type": "string",
                "enum": ["bootstrap", "pre_seed", "seed", "series_a", "series_b", "revenue_based"]
              },
              "amount": {
                "type": "number",
                "minimum": 0
              },
              "timing": {
                "type": "string",
                "description": "When funding is needed"
              },
              "purpose": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": [
                    "product_development",
                    "market_expansion",
                    "team_growth",
                    "infrastructure",
                    "working_capital",
                    "marketing"
                  ]
                }
              },
              "milestones": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Key milestones to achieve with this funding"
              }
            },
            "required": ["stageId", "stageName", "amount", "timing", "purpose"]
          }
        },
        "alternatives": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["revenue_based_financing", "grants", "crowdfunding", "partnerships", "bootstrapping"]
              },
              "description": {
                "type": "string"
              },
              "feasibility": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              },
              "amount": {
                "type": "number",
                "minimum": 0
              }
            },
            "required": ["type", "description", "feasibility"]
          }
        }
      },
      "required": ["totalRequired", "stages"]
    },
    "breakEvenAnalysis": {
      "type": "object",
      "properties": {
        "scenarios": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "scenarioName": {
                "type": "string",
                "enum": ["conservative", "realistic", "optimistic"]
              },
              "breakEvenMonth": {
                "type": "integer",
                "minimum": 1,
                "description": "Month when break-even is achieved"
              },
              "breakEvenUsers": {
                "type": "integer",
                "minimum": 0,
                "description": "Number of users needed for break-even"
              },
              "breakEvenRevenue": {
                "type": "number",
                "minimum": 0,
                "description": "Monthly revenue needed for break-even"
              },
              "assumptions": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            },
            "required": ["scenarioName", "breakEvenMonth", "breakEvenUsers", "breakEvenRevenue"]
          }
        }
      },
      "required": ["scenarios"]
    },
    "validationMetrics": {
      "type": "object",
      "properties": {
        "accuracy": {
          "type": "object",
          "properties": {
            "historical_variance": {
              "type": "number",
              "description": "Historical forecast accuracy as percentage"
            },
            "confidence_interval": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Statistical confidence interval"
            }
          }
        },
        "benchmarks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "metric": {
                "type": "string",
                "enum": ["growth_rate", "conversion_rate", "churn_rate", "arpu", "ltv_cac_ratio"]
              },
              "industry_average": {
                "type": "number"
              },
              "our_target": {
                "type": "number"
              },
              "source": {
                "type": "string",
                "description": "Source of industry benchmark"
              }
            },
            "required": ["metric", "industry_average", "our_target", "source"]
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        },
        "createdBy": {
          "type": "string",
          "description": "Who created this forecast"
        },
        "approvedBy": {
          "type": "string",
          "description": "Who approved this forecast"
        },
        "reviewDate": {
          "type": "string",
          "format": "date",
          "description": "Next review date"
        },
        "currency": {
          "type": "string",
          "pattern": "^[A-Z]{3}$",
          "default": "USD"
        },
        "methodology": {
          "type": "string",
          "description": "Forecasting methodology used"
        }
      },
      "required": ["createdAt", "version", "currency"]
    }
  },
  "required": [
    "forecastId",
    "forecastName",
    "timeframe",
    "scenarios",
    "breakEvenAnalysis",
    "metadata"
  ],
  "additionalProperties": false
}
