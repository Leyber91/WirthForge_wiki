---
title: "Energy Pattern Detection & Visualization Flow"
config:
  theme: dark
  themeVariables:
    primaryColor: "#00ff88"
    primaryTextColor: "#ffffff"
    primaryBorderColor: "#27ae60"
    lineColor: "#61dafb"
    secondaryColor: "#ff6b6b"
    tertiaryColor: "#feca57"
    background: "#0d1117"
    mainBkg: "#161b22"
    secondBkg: "#21262d"
---

flowchart TD
    %% Input Sources
    subgraph INPUTS["ğŸ”„ Energy Input Sources"]
        ModelA["ğŸ¤– Model A<br/>Ollama/Llama2:7B<br/>Energy: 4.2 EU/frame"]
        ModelB["ğŸ¤– Model B<br/>Ollama/Mistral:7B<br/>Energy: 3.8 EU/frame"]
        ModelC["ğŸ¤– Model C<br/>OpenAI/GPT-4<br/>Energy: 5.1 EU/frame"]
        UserInput["ğŸ‘¤ User Input<br/>Prompt Energy<br/>Variable: 0.5-2.0 EU"]
    end

    %% Energy Calculation Engine
    subgraph CALC["âš¡ Energy Calculation Engine"]
        EnergyCalc["Energy Calculator<br/>ğŸ“Š Frame-by-frame<br/>ğŸ¯ 60Hz processing<br/>âš–ï¸ Conservation laws"]
        
        PatternDetector["Pattern Detector<br/>ğŸ” Interference analysis<br/>ğŸŒŠ Resonance detection<br/>ğŸ“ˆ Frequency analysis"]
        
        Accumulator["Energy Accumulator<br/>ğŸ’¾ Total: Î£(deltas)<br/>ğŸ“Š Model contributions<br/>â±ï¸ Temporal tracking"]
    end

    %% Pattern Types
    subgraph PATTERNS["ğŸŒŠ Pattern Detection"]
        direction TB
        
        subgraph INTERFERENCE["âš¡ Interference Patterns"]
            ConstructiveInt["ğŸ”º Constructive<br/>â€¢ Models align<br/>â€¢ Energy amplified<br/>â€¢ Strength: 0.7-1.0<br/>â€¢ Duration: 100-500ms"]
            
            DestructiveInt["ğŸ”» Destructive<br/>â€¢ Models conflict<br/>â€¢ Energy dampened<br/>â€¢ Strength: -0.3 to -0.8<br/>â€¢ Duration: 50-200ms"]
        end
        
        subgraph RESONANCE["ğŸµ Resonance Patterns"]
            SyncResonance["ğŸ¯ Synchronous<br/>â€¢ Perfect timing<br/>â€¢ 2x-5x amplification<br/>â€¢ Frequency: 40-60Hz<br/>â€¢ Rare: <5% sessions"]
            
            HarmonicRes["ğŸ¼ Harmonic<br/>â€¢ Frequency multiples<br/>â€¢ 1.5x-3x amplification<br/>â€¢ Sustained: 1-10s<br/>â€¢ Common: 15% sessions"]
        end
    end

    %% State Management
    subgraph STATE["ğŸ’¾ State Management"]
        CurrentState["Current State<br/>ğŸ¯ Frame state<br/>âš¡ Energy current<br/>ğŸ“Š Accumulator<br/>ğŸ® Session context"]
        
        EventQueue["Event Queue<br/>ğŸ“¥ Async buffer<br/>ğŸ”„ 15 event batches<br/>â±ï¸ 200ms timeout<br/>ğŸ“Š Max 1000 events"]
        
        Snapshots["Snapshots<br/>ğŸ“¸ Every 1000 events<br/>ğŸ”„ Recovery points<br/>ğŸ’¾ JSON serialized<br/>â±ï¸ Timestamp indexed"]
    end

    %% Visualization Engine
    subgraph VIZ["ğŸ¨ Visualization Engine"]
        EnergyGraph["Energy Graph<br/>ğŸ“ˆ Real-time plot<br/>ğŸ¯ 60Hz updates<br/>ğŸ“Š Multi-model overlay<br/>ğŸŒˆ Color-coded"]
        
        PatternViz["Pattern Visualizer<br/>ğŸŒŠ Wave animations<br/>âš¡ Interference effects<br/>ğŸµ Resonance ripples<br/>ğŸ¨ Dynamic colors"]
        
        MetricsDisplay["Metrics Display<br/>ğŸ“Š Performance stats<br/>â±ï¸ Frame timing<br/>ğŸ’¾ Memory usage<br/>ğŸ”„ Queue depth"]
    end

    %% Data Flow Connections
    ModelA --> EnergyCalc
    ModelB --> EnergyCalc
    ModelC --> EnergyCalc
    UserInput --> EnergyCalc
    
    EnergyCalc --> PatternDetector
    EnergyCalc --> Accumulator
    
    PatternDetector --> ConstructiveInt
    PatternDetector --> DestructiveInt
    PatternDetector --> SyncResonance
    PatternDetector --> HarmonicRes
    
    ConstructiveInt --> CurrentState
    DestructiveInt --> CurrentState
    SyncResonance --> CurrentState
    HarmonicRes --> CurrentState
    
    Accumulator --> CurrentState
    CurrentState --> EventQueue
    EventQueue --> Snapshots
    
    CurrentState --> EnergyGraph
    ConstructiveInt --> PatternViz
    DestructiveInt --> PatternViz
    SyncResonance --> PatternViz
    HarmonicRes --> PatternViz
    
    EventQueue --> MetricsDisplay
    Snapshots --> MetricsDisplay

    %% Pattern Analysis Details
    subgraph ANALYSIS["ğŸ”¬ Pattern Analysis Details"]
        direction LR
        
        FreqAnalysis["Frequency Analysis<br/>ğŸ“Š FFT processing<br/>ğŸ¯ 40-60Hz detection<br/>ğŸ“ˆ Spectral density<br/>â±ï¸ Sliding window"]
        
        CorrelationCalc["Correlation Calculator<br/>ğŸ“Š Cross-correlation<br/>ğŸ¯ Phase alignment<br/>ğŸ“ˆ Coherence measure<br/>â±ï¸ Time-delayed"]
        
        AmplificationCalc["Amplification Calculator<br/>ğŸ“Š Energy ratios<br/>ğŸ¯ Peak detection<br/>ğŸ“ˆ Sustained levels<br/>â±ï¸ Duration tracking"]
    end

    PatternDetector --> FreqAnalysis
    PatternDetector --> CorrelationCalc
    PatternDetector --> AmplificationCalc

    %% Real-time Processing Pipeline
    subgraph PIPELINE["ğŸ”„ Real-time Processing Pipeline"]
        direction TB
        
        Frame1["Frame N<br/>â±ï¸ t=0ms<br/>ğŸ“Š Collect energies<br/>ğŸ” Detect patterns"]
        Frame2["Frame N+1<br/>â±ï¸ t=16.67ms<br/>ğŸ“Š Update accumulator<br/>ğŸ¨ Update visuals"]
        Frame3["Frame N+2<br/>â±ï¸ t=33.33ms<br/>ğŸ“Š Queue events<br/>ğŸ’¾ Background write"]
        
        Frame1 --> Frame2
        Frame2 --> Frame3
        Frame3 --> Frame1
    end

    EnergyCalc -.-> Frame1
    PatternDetector -.-> Frame1
    CurrentState -.-> Frame2
    EventQueue -.-> Frame3

    %% Performance Annotations
    note1["Performance Targets:<br/>â€¢ Frame budget: <16.67ms<br/>â€¢ Pattern detection: <5ms<br/>â€¢ Visualization update: <8ms<br/>â€¢ Event queuing: <2ms"]
    
    note2["Pattern Thresholds:<br/>â€¢ Interference: |correlation| > 0.6<br/>â€¢ Resonance: coherence > 0.8<br/>â€¢ Amplification: ratio > 1.5x<br/>â€¢ Duration: >100ms sustained"]
    
    note3["Energy Conservation:<br/>â€¢ Total = Î£(model_energies)<br/>â€¢ Tolerance: Â±0.01 EU<br/>â€¢ Validation: every frame<br/>â€¢ Audit: full session"]

    %% Styling
    classDef inputClass fill:#4a90e2,stroke:#2c5aa0,stroke-width:2px,color:#fff
    classDef calcClass fill:#27ae60,stroke:#229954,stroke-width:2px,color:#fff
    classDef patternClass fill:#e74c3c,stroke:#c0392b,stroke-width:2px,color:#fff
    classDef stateClass fill:#f39c12,stroke:#e67e22,stroke-width:2px,color:#fff
    classDef vizClass fill:#9b59b6,stroke:#8e44ad,stroke-width:2px,color:#fff
    classDef analysisClass fill:#1abc9c,stroke:#16a085,stroke-width:2px,color:#fff
    classDef pipelineClass fill:#34495e,stroke:#2c3e50,stroke-width:2px,color:#fff

    class ModelA,ModelB,ModelC,UserInput inputClass
    class EnergyCalc,PatternDetector,Accumulator calcClass
    class ConstructiveInt,DestructiveInt,SyncResonance,HarmonicRes patternClass
    class CurrentState,EventQueue,Snapshots stateClass
    class EnergyGraph,PatternViz,MetricsDisplay vizClass
    class FreqAnalysis,CorrelationCalc,AmplificationCalc analysisClass
    class Frame1,Frame2,Frame3 pipelineClass
