sequenceDiagram
    participant U as ğŸ§‘â€ğŸ’» User
    participant B as ğŸŒ Browser UI
    participant WS as âš¡ WebSocket Server<br/>(localhost:8145)
    participant O as ğŸ­ Orchestrator
    participant D as ğŸ”® DECIPHER<br/>(Energy Engine)
    participant M as ğŸ¤– AI Model Pool

    Note over U,M: ğŸš€ WIRTHFORGE Real-Time Protocol Lifecycle (60Hz Energy Truth)
    
    rect rgb(240, 248, 255)
        Note over U,M: ğŸ”Œ PHASE 1: CONNECTION & HANDSHAKE
        U->>B: Launch WIRTHFORGE
        B->>WS: ğŸ”— WebSocket Connect<br/>ws://localhost:8145/ws
        WS-->>B: âœ… Connection Accepted
        
        O->>WS: ğŸ¯ System Ready Signal
        WS->>B: ğŸ“¡ startup_complete Event
        Note right of B: ğŸ“‹ System Status<br/>{<br/>  "type": "startup_complete",<br/>  "model": "LLaMA2-13B",<br/>  "tier": "Mid-Tier",<br/>  "frameRate": 60,<br/>  "energyTruth": true<br/>}
        
        B-->>WS: ğŸ¤ Handshake ACK
    end
    
    rect rgb(245, 255, 245)
        Note over U,M: âš¡ PHASE 2: 60Hz ENERGY TRUTH LOOP
        loop Every 16.67ms (60Hz Frame)
            D->>WS: ğŸŒŠ energy_update Event
            WS->>B: ğŸ“Š Energy Visualization Data
            Note right of B: âš¡ Energy Frame<br/>{<br/>  "type": "energy_update",<br/>  "frameNumber": N,<br/>  "totalEnergy": 1250.5,<br/>  "energyField": [...]<br/>}
            
            alt ğŸ”¥ Token Generation Active
                M->>D: ğŸ¯ New Token Stream
                D->>D: ğŸ§® Compute E(t) = f(Î”t, entropy, logprobs)
                D->>WS: ğŸŒŸ token_stream Event
                WS->>B: ğŸ’« Real-time Tokens
                Note right of B: ğŸ­ Token Stream<br/>{<br/>  "type": "token_stream",<br/>  "tokens": ["Hello", "world"],<br/>  "energy": 0.85,<br/>  "isComplete": false<br/>}
            end
            
            alt ğŸª Multi-Model Council Mode
                M->>D: ğŸ”€ Parallel Token Streams
                D->>D: ğŸŒ€ Detect Interference Patterns
                D->>WS: âš¡ interference_event
                WS->>B: ğŸŒŠ Interference Visualization
                D->>D: ğŸµ Detect Resonance Sync
                D->>WS: ğŸ† resonance_event
                WS->>B: âœ¨ Resonance Celebration
            end
        end
    end
    
    rect rgb(255, 248, 240)
        Note over U,M: ğŸ’“ PHASE 3: HEALTH & MONITORING
        loop Every 1 second
            WS->>B: ğŸ’“ heartbeat Event
            Note right of B: ğŸ©º Health Check<br/>{<br/>  "type": "heartbeat",<br/>  "sequence": N,<br/>  "serverTime": timestamp,<br/>  "fps": 60.0<br/>}
            B-->>WS: ğŸ’“ Heartbeat Response
        end
    end
    
    rect rgb(255, 245, 245)
        Note over U,M: âš ï¸ PHASE 4: ERROR HANDLING
        alt ğŸš¨ Performance Issue
            D->>WS: âš ï¸ Frame Overrun Detected
            WS->>B: ğŸš¨ error_event
            Note right of B: âš ï¸ System Alert<br/>{<br/>  "type": "error_event",<br/>  "severity": "warning",<br/>  "code": "FRAME_OVERRUN",<br/>  "fps": 45.2<br/>}
            B->>U: ğŸ”§ Performance Warning
        end
    end
    
    rect rgb(248, 255, 248)
        Note over U,M: ğŸ† PHASE 5: ACHIEVEMENTS
        alt ğŸ‰ Milestone Reached
            O->>WS: ğŸ† Achievement Unlocked
            WS->>B: ğŸŠ reward_event
            Note right of B: ğŸ† Achievement<br/>{<br/>  "type": "reward_event",<br/>  "rewardType": "milestone",<br/>  "title": "Lightning Master",<br/>  "level": 3<br/>}
            B->>U: ğŸ‰ Celebration Animation
        end
    end
    
    rect rgb(255, 240, 245)
        Note over U,M: ğŸ”„ PHASE 6: RECOVERY & RESILIENCE
        B-xWS: ğŸ’” Connection Lost
        Note over B,WS: ğŸŒ Network Interruption
        
        B->>WS: ğŸ”„ Auto-Reconnect (Exponential Backoff)
        WS-->>B: âœ… Connection Restored
        WS->>B: ğŸ”„ startup_complete (Resume State)
        Note right of B: ğŸ”„ State Recovery<br/>Session restored<br/>Energy field synchronized
    end
    
    rect rgb(245, 245, 255)
        Note over U,M: ğŸ‘‹ PHASE 7: GRACEFUL SHUTDOWN
        U->>B: ğŸ›‘ Close Application
        B->>WS: ğŸ‘‹ Close Connection
        WS->>O: ğŸ“´ Client Disconnected
        WS-->>B: âœ… Connection Closed
        Note over U,M: ğŸ Session Complete - All data preserved locally
    end
